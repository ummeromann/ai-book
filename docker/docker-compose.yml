version: '3.8'

services:
  # ROS 2 Humble development environment
  ros2-humble:
    build:
      context: .
      dockerfile: Dockerfile.ros2
    image: physical-ai-book/ros2-humble:latest
    container_name: ros2-dev
    volumes:
      - ../code-examples:/workspace/code-examples
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
    environment:
      - DISPLAY=${DISPLAY}
      - QT_X11_NO_MITSHM=1
      - ROS_DOMAIN_ID=42
    network_mode: host
    stdin_open: true
    tty: true
    command: /bin/bash

  # Gazebo simulation environment
  gazebo-sim:
    build:
      context: .
      dockerfile: Dockerfile.ros2
    image: physical-ai-book/ros2-humble:latest
    container_name: gazebo-sim
    volumes:
      - ../code-examples:/workspace/code-examples
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
    environment:
      - DISPLAY=${DISPLAY}
      - QT_X11_NO_MITSHM=1
      - LIBGL_ALWAYS_SOFTWARE=1
    network_mode: host
    depends_on:
      - ros2-humble
    command: ros2 launch gazebo_ros gazebo.launch.py

  # Isaac Sim environment (requires NVIDIA GPU)
  isaac-sim:
    build:
      context: .
      dockerfile: Dockerfile.isaac
    image: physical-ai-book/isaac-sim:latest
    container_name: isaac-sim
    runtime: nvidia
    volumes:
      - ../code-examples:/workspace/code-examples
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
    environment:
      - DISPLAY=${DISPLAY}
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all
    network_mode: host
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    command: /bin/bash

networks:
  default:
    name: physical-ai-network
